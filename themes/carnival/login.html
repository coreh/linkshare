<!-- Festive top border -->
<div class="ls-carnival-border"></div>

<canvas class="ls-confetti-canvas" id="confettiCanvas"></canvas>

<div class="container mx-auto px-4 py-16 max-w-md flex items-center justify-center min-h-screen">
    <div>
        <!-- Navigation -->
        <nav class="mb-8 {{muted}} text-center">
            <a href="/" class="{{hover_text}} transition-colors">{{t "ğŸ  Home"}}</a>
            {{#if parent.path}}
            <span class="mx-2">/</span>
            <a href="{{parent.path}}" class="{{hover_text}} transition-colors">{{t "â†‘ Back"}}</a>
            {{/if}}
        </nav>

        <div class="{{card_static}} border rounded-2xl p-8 shadow-2xl backdrop-blur-sm">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4 ls-carnival-mask">ğŸ­</div>
                <h1 class="text-3xl font-bold mb-2 ls-carnival-title {{dc "text-yellow-300" "text-purple-800"}}">{{title}}</h1>
                <p class="{{muted}}">{{t "This celebration is protected"}}</p>
            </div>

            {{#if error}}
            <div class="mb-6 p-4 {{dc "bg-red-500/20 border-red-500/50 text-red-300" "bg-red-100 border-red-300 text-red-700"}} border rounded-lg text-center">
                {{error}}
            </div>
            {{/if}}

            <form method="POST" action="{{path}}">
                <div class="mb-6">
                    <label for="password" class="block mb-2 {{dc "text-purple-200" "text-purple-700"}} font-semibold">{{t "Password"}}</label>
                    <input
                        type="password"
                        id="password"
                        name="password"
                        required
                        class="{{input}} w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 {{dc "focus:ring-yellow-400" "focus:ring-purple-500"}} transition-all"
                        placeholder="{{t "Enter password to join the party"}}"
                        autofocus
                    >
                </div>
                <button
                    type="submit"
                    class="w-full {{dc "bg-gradient-to-r from-purple-600 to-yellow-500 hover:from-purple-500 hover:to-yellow-400 text-white" "bg-gradient-to-r from-purple-600 to-yellow-500 hover:from-purple-700 hover:to-yellow-600 text-white"}} font-bold py-3 px-6 rounded-lg transition-all scale-100 hover:scale-105 shadow-lg"
                >
                    {{t "ğŸ‰ Enter the Carnival"}}
                </button>
            </form>
        </div>

        <div class="text-center mt-8 {{muted}} text-sm">
            {{t "ğŸª Protected by LinkShare ğŸª"}}
        </div>
    </div>
</div>

<script>
(function() {
  var canvas = document.getElementById('confettiCanvas');
  var ctx = canvas.getContext('2d');
  var W, H, N = 40, PR = 8, MP = 25;
  var colors = ['#7c3aed','#fbbf24','#10b981','#ec4899','#f97316','#06b6d4'];
  var pieces = [], surfs = [], landed = [], maxLanded = 200, fc = 0, seeded = false;

  function sz() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
  sz();
  addEventListener('resize', function() { sz(); scan(); });

  function scan() {
    var sy = scrollY, old = surfs;
    surfs = [];
    var els = document.querySelectorAll(
      '[class*="rounded"][class*="border"],[class*="border"][class*="rounded"],[data-embed-container]'
    );
    for (var i = 0; i < els.length; i++) {
      if (els[i] === canvas) continue;
      var r = els[i].getBoundingClientRect();
      if (r.width < 40 || r.height < 15) continue;
      var dt = Math.round(r.top + sy), l = Math.round(r.left), ri = Math.round(r.right);
      var cols = Math.ceil((ri - l) / PR), pile = null;
      for (var j = 0; j < old.length; j++) {
        if (Math.abs(old[j].t - dt) < 8 && Math.abs(old[j].l - l) < 8 && old[j].p.length === cols) {
          pile = old[j].p; old.splice(j, 1); break;
        }
      }
      if (!pile) pile = new Float32Array(cols);
      surfs.push({ l: l, r: ri, t: dt, p: pile });
    }
    if (!seeded && surfs.length > 0) {
      seeded = true;
      for (var si = 0; si < surfs.length; si++) {
        var sp = surfs[si].p, sl = surfs[si];
        for (var k = 0; k < sp.length; k++) {
          var edge = Math.min(k, sp.length - 1 - k);
          sp[k] = Math.min(1, edge / 3) * (2 + Math.random() * 4);
        }
        for (var k = 0; k < 15; k++) {
          var lx = sl.l + Math.random() * (sl.r - sl.l);
          var col = Math.floor((lx - sl.l) / PR);
          var isStrip = Math.random() < 0.33;
          landed.push({
            dx: lx, dy: sl.t - (sp[col] || 0) * Math.random(),
            w: isStrip ? Math.random() * 2 + 1 : Math.random() * 6 + 4,
            h: isStrip ? Math.random() * 10 + 8 : Math.random() * 6 + 4,
            c: colors[Math.floor(Math.random() * 6)],
            ic: !isStrip && Math.random() < 0.33,
            rot: Math.random() * 6.28, fl: Math.random() * 6.28,
            o: 0.5 + Math.random() * 0.3
          });
        }
      }
    }
  }

  function mk(full) {
    var isStrip = Math.random() < 0.33;
    return {
      x: Math.random() * W, y: full ? Math.random() * H : -Math.random() * 30 - 10,
      w: isStrip ? Math.random() * 2 + 1 : Math.random() * 6 + 4,
      h: isStrip ? Math.random() * 10 + 8 : Math.random() * 6 + 4,
      c: colors[Math.floor(Math.random() * 6)],
      ic: !isStrip && Math.random() < 0.33,
      rot: Math.random() * 6.28, rs: (Math.random() - 0.5) * 0.08,
      vx: (Math.random() - 0.5) * 0.8, vy: Math.random() * 1.2 + 0.4,
      wb: Math.random() * 6.28, wbs: Math.random() * 0.04 + 0.01,
      o: Math.random() * 0.4 + 0.6,
      fl: Math.random() * 6.28, fls: Math.random() * 0.05 + 0.02
    };
  }

  function drawShape(x, y, p) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(p.rot);
    ctx.scale(Math.cos(p.fl), 1);
    ctx.globalAlpha = p.o;
    ctx.fillStyle = p.c;
    if (p.ic) {
      ctx.beginPath(); ctx.arc(0, 0, p.w / 2, 0, 6.28); ctx.fill();
    } else {
      ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
    }
    ctx.restore();
  }

  for (var i = 0; i < N; i++) pieces.push(mk(true));
  scan();

  function frame() {
    ctx.clearRect(0, 0, W, H);
    var sy = scrollY;
    if (++fc % 120 === 0) scan();

    for (var i = 0; i < landed.length; i++) {
      var lp = landed[i], vy = lp.dy - sy;
      if (vy < -30 || vy > H + 30) continue;
      drawShape(lp.dx, vy, lp);
    }

    for (var i = 0; i < N; i++) {
      var p = pieces[i];
      p.wb += p.wbs; p.fl += p.fls; p.rot += p.rs;
      p.x += Math.sin(p.wb) * 0.8 + p.vx;
      p.y += p.vy;
      var dy = p.y + sy, hit = false;

      for (var j = 0; j < surfs.length; j++) {
        var s = surfs[j];
        if (p.x >= s.l && p.x < s.r) {
          var col = Math.floor((p.x - s.l) / PR);
          if (col >= 0 && col < s.p.length && dy >= s.t - s.p[col] - 2) {
            if (s.p[col] < MP) {
              s.p[col] += 1.2 + Math.random() * 0.8;
              if (col > 0) s.p[col - 1] = Math.min(MP, s.p[col - 1] + 0.4);
              if (col < s.p.length - 1) s.p[col + 1] = Math.min(MP, s.p[col + 1] + 0.4);
            }
            if (landed.length >= maxLanded) landed.shift();
            landed.push({
              dx: p.x + (Math.random() - 0.5) * 3,
              dy: s.t - s.p[col] + Math.random() * 2,
              w: p.w, h: p.h, c: p.c, ic: p.ic,
              rot: p.rot, fl: p.fl, o: p.o * 0.85
            });
            hit = true; break;
          }
        }
      }

      if (hit || p.y > H + 20) { pieces[i] = mk(false); continue; }
      drawShape(p.x, p.y, p);
    }

    requestAnimationFrame(frame);
  }
  frame();
})();
</script>
